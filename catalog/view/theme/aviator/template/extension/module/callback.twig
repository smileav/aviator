<style>
    .modal-open #modal-callback {
        text-align: center;
        z-index: 10000;
    }
    .modal-open .modal-backdrop {
        z-index: 9999;
    }
    .modal-dialog {
        display: inline-block;
        text-align: left;
        vertical-align: middle;
    }
    .modal-head {
        font-size: 32px;
        font-weight: 500;
        line-height: 100%;
        text-transform: uppercase;
    }
    .modal input, .modal textarea {
        font-size: 16px;
        font-weight: 500;
        color: #000;
        width: 100%;
        border: 1px solid #000;
        border-radius: 0;
        padding: 26px 16px 14px 16px;
        outline: 0;
    }
    .modal input {
        height: 58px;
    }
    .modal textarea {
        resize: none;
    }

    .modal-form {
        margin: 24px 0;
    }
    .form-group {
        position: relative;
        margin-bottom: 0;
    }
    input.focus ~ .float-label, input[name="phone"]:hover ~ .float-label, input[name="email"]:hover ~ .float-label, textarea.focus ~ .float-label
     {
        top: 10px;
        left: 18px;
        font-size: 10px;
        text-transform: none;
    }
    .float-label {
        position: absolute;
        pointer-events: none;
        top: 21px;
        right: 16px;
        left: 16px;
        -webkit-transition: opacity .3s ease;
        transition: .3s ease all;
        font-size: 16px;
        font-weight: 500;
        line-height: 100%;
        color: #a4a5a7;
        text-transform: uppercase;
    }
    .float-label > span {
        color: #f7352a;
    }
    .form-group .error {
        border-color: #f7352a;
    }
    .form-error {
        font-size: 12px;
        font-weight: 500;
        line-height: normal;
        color: #f7352a;
        height: 24px;
    }
    .modal-total {
        font-size: 20px;
        font-weight: 500;
        line-height: normal;
        text-transform: uppercase;
        margin-bottom: 24px;
    }
    .modal .btn-b {
        font-size: 20px;
        font-weight: 500;
        line-height: normal;
        text-transform: uppercase;
        width: 100%;
        max-width: 410px;
        height: 76px;
        margin: auto;
    }

    .modal-success-text, .modal-success-thank {
        font-size: 14px;
        line-height: 140%;
        color: #7c7c7c;
    }
    .modal-success-text {
        margin: 26px 0 12px 0;
    }
    .modal-success-text > a {
        color: #7c7c7c;
        text-decoration: underline;
    }
    .modal-success-text > a:hover {
        color: #000;
    }

    /* Wait */
    .lds-ellipsis {
        position: fixed;
        right: 0;
        bottom: 300px;
        left: 0;
        margin: auto;
        z-index: 10010;
    }
    .lds-ellipsis {
        display: inline-block;
        width: 80px;
        height: 80px;
    }
    .lds-ellipsis div {
        position: absolute;
        top: 33px;
        width: 16px;
        height: 16px;
        background: #000;
        animation-timing-function: cubic-bezier(0, 1, 1, 0);
    }
    .lds-ellipsis div:nth-child(1) {
        left: 8px;
        animation: lds-ellipsis1 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(2) {
        left: 8px;
        animation: lds-ellipsis2 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(3) {
        left: 32px;
        animation: lds-ellipsis2 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(4) {
        left: 56px;
        animation: lds-ellipsis3 0.6s infinite;
    }
    @keyframes lds-ellipsis1 {
        0% {
            transform: scale(0);
        }
        100% {
            transform: scale(1);
        }
    }
    @keyframes lds-ellipsis3 {
        0% {
            transform: scale(1);
        }
        100% {
            transform: scale(0);
        }
    }
    @keyframes lds-ellipsis2 {
        0% {
            transform: translate(0, 0);
        }
        100% {
            transform: translate(24px, 0);
        }
    }
    @media (min-width: 768px) {
        .modal:before {
            display: inline-block;
            vertical-align: middle;
            content: " ";
            height: 100%;
        }
        .modal-dialog {
            width: 688px;
            margin: auto;
        }
    }

    @media (max-width: 991px) {
        .modal-head {
            font-size: 24px;
        }
        .modal-body {
            padding: 24px;
        }
        .modal input {
            height: 52px;
        }
        .modal input, .modal textarea {
            font-size: 14px;
        }
        .float-label {
            left: 12px;
            top: 19px;
            right: 12px;
            font-size: 14px;
        }
        .form-error {
            font-size: 10px;
            height: 18px;
        }
        .modal-total {
            font-size: 16px;
        }
        .modal .btn-b {
            font-size: 16px;
            height: 62px;
        }
    }
    @media (max-width: 767px) {
        .modal {
            top: 15px;
            left: 15px;
            right: 15px;
        }
        .modal-dialog {
            width: 100%;
            margin: 0;
        }
        .modal-body {
            padding: 16px;
        }
        .modal-head > div {
            padding-right: 32px;
        }
        .modal-form {
            margin: 16px 0;
        }
        .modal-total {
            margin-bottom: 16px;
        }
        .modal .btn-b {
            width: 100%;
        }
    }
</style>
<div id="modal-callback" class="modal fade" data-type="order" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="modal-head d-f ai-c jc-sb">
                    {% if not suggest %}
                    <div>{{ text_head }}</div>
                    {% else %}
                    <div>{{ text_head_suggest }}</div>
                    {% endif %}
                    <button type="button" class="close" data-dismiss="modal"><svg class="i-close" width="14" height="14"><use xlink:href="image/icons.svg#i-close" xmlns:xlink="http://www.w3.org/1999/xlink"></use></svg></button>
                </div>
                <div class="modal-in">
                    <div class="modal-form">
                        <div class="form-group required">
                            <input type="text" name="name" required/>
                            <div class="float-label">{{ text_form_name }} <span>*</span></div>
                            <div class="form-error"></div>
                        </div>
                        {% if not suggest %}
                        <div class="form-group required">
                            <input type="text" name="phone" required/>
                            <div class="float-label">{{ text_form_phone }} <span>*</span></div>
                            <div class="form-error"></div>
                        </div>
                        <div class="form-group">
                            <textarea name="comment" rows="3"></textarea>
                            <div class="float-label">{{ text_form_comment }}</div>
                        </div>
                        {% else %}
                        <div class="form-group required">
                            <input type="text" name="email" required/>
                            <div class="float-label">E-mail <span>*</span></div>
                            <div class="form-error"></div>
                        </div>
                        <div class="form-group required">
                            <textarea name="comment" rows="3" required></textarea>
                            <div class="float-label">{{ text_form_comment_suggest }} <span>*</span></div>
                            <div class="form-error"></div>
                        </div>
                        {% endif %}
                    </div>
                    {% if not suggest %}
                    <div class="modal-button">
                        <button id="button-confirm" type="button" data-loading-text="{{ text_loading }}" class="btn-b d-f ai-c jc-c">{{ text_button }}</button>
                    </div>
                    {% else %}
                    <div class="modal-button">
                        <button id="button-confirm" type="button" data-loading-text="{{ text_loading }}" class="btn-b d-f ai-c jc-c">{{ text_button_suggest }}</button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<script src="catalog/view/javascript/inputmask/jquery.inputmask.min.js" type="text/javascript"></script>
<script>
$('input[name="phone"]').inputmask({ mask: '+38 (099) 999-99-99', placeholder: 'Ð¥' });
$('input[name="email"]').inputmask({ alias: 'email' });
var focus = $('#modal-callback .form-group input, #modal-callback .form-group textarea');
focus.focusin(function () {
    $(this).addClass('focus');
});
focus.focusout(function () {
    if (!$(this).val()) {
        $(this).removeClass('focus');
    };
});
var url = 'index.php?route=extension/module/callback/confirm';
{% if suggest %}
url = 'index.php?route=extension/module/callback/confirm&suggest=1';
{% endif %}
$('#modal-callback #button-confirm').on('click', function() {
    var modal = $('#modal-callback');

    $.ajax({
        url: url,
        type: 'post',
        data: $('#modal-callback input, #modal-callback textarea'),
        dataType: 'json',
        beforeSend: function() {
            modal.find('#button-confirm').button('loading');
            modal.find('.modal-content').attr('style', 'opacity: 0.9');
            $('<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>').prependTo(modal.find('.modal-content'));
            modal.find('.modal-button > button').button('loading');
        },
        complete: function() {
            modal.find('.modal-content').attr('style', '');
            modal.find('.lds-ellipsis').remove();
            modal.find('.modal-button > button').button('reset');
            modal.find('#button-confirm').button('reset');
        },
        success: function(json) {
            modal.find('input').removeClass('error');
            modal.find('.form-error').text('');

            if (json['error']) {
                if (json['error']['name']) {
                    modal.find('input[name="name"]').addClass('error').next().next().text(json['error']['name']);
                }

                if (json['error']['phone']) {
                    modal.find('input[name="phone"]').addClass('error').next().next().text(json['error']['phone']);
                }

                if (json['error']['email']) {
                    modal.find('input[name="email"]').addClass('error').next().next().text(json['error']['email']);
                }

                if (json['error']['comment']) {
                    modal.find('textarea[name="comment"]').addClass('error').next().next().text(json['error']['comment']);
                }
            }

            if (json['success']) {
                $('#cart').load('index.php?route=common/cart/info');
                modal.attr('data-type', 'success');
                modal.find('.modal-head > div').text(json['success_head']);
                modal.find('.modal-in').remove();
                modal.find('.modal-body').append('<div class="modal-success-text">' + json['success_text'] + '</div>');
                modal.find('.modal-body').append('<div class="modal-success-thank">' + json['success_thank'] + '</div>');
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});
</script>
